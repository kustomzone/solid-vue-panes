(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e8c679c2"],{4380:function(e,t,n){"use strict";n("4160"),n("b0c0"),n("159b"),n("96cf");var r=n("1da1"),s=n("4d8d"),o=n("6dc1"),a=window.solid;t["a"]={methods:{getProfile:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,r,c,i,l,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={friends:[]},n.webId=t,e.prev=2,e.next=5,Object(s["b"])(t);case 5:return r=e.sent,c=r.getSubject(t),e.next=9,c.getString(o["i"].fn);case 9:return n.name=e.sent,e.next=12,c.getString("http://www.w3.org/2006/vcard/ns#organization-name");case 12:return n.organization=e.sent,e.next=15,c.getString(o["i"].role);case 15:return n.role=e.sent,e.next=18,c.getRef(o["i"].hasAddress);case 18:if(i=e.sent,null==i){e.next=24;break}return l=r.getSubject(i),e.next=23,l.getString(o["i"].locality);case 23:n.locality=e.sent;case 24:return e.next=26,a.data[t].vcard$hasPhoto;case 26:u=e.sent,n.photo="".concat(u),e.next=33;break;case 30:e.prev=30,e.t0=e["catch"](2),this.makeToast(e.t0.message,t,"warning");case 33:return e.abrupt("return",n);case 34:case"end":return e.stop()}}),e,this,[[2,30]])})));function t(t){return e.apply(this,arguments)}return t}(),getInboxUrls:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=[],e.prev=1,e.next=4,Object(s["b"])(t);case 4:return r=e.sent,a=r.getSubject(t),e.next=8,a.getAllRefs(o["c"].inbox);case 8:n=e.sent,e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](1),this.makeToast(e.t0.message,t,"warning");case 14:return e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,this,[[1,11]])})));function t(t){return e.apply(this,arguments)}return t}(),getFriends:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=[],e.prev=1,e.next=4,Object(s["b"])(t);case 4:return r=e.sent,a=r.getSubject(t),e.next=8,a.getAllRefs(o["b"].knows);case 8:n=e.sent,e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](1),this.makeToast(e.t0.message,t,"warning");case 14:return e.abrupt("return",n);case 15:case"end":return e.stop()}}),e,this,[[1,11]])})));function t(t){return e.apply(this,arguments)}return t}(),addIndex:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t,n,r){var a,c,i,l,u,b;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t+"/index.ttl#this",c=new Date,i=c.toISOString(),l=this.$store.state.solid.indexes.puti,e.next=6,Object(s["b"])(l.url);case 6:return u=e.sent,e.next=9,u.addSubject();case 9:return b=e.sent,b.addLiteral(o["e"].label,r),b.addNodeRef("http://www.w3.org/ns/solid/terms#forClass",n),b.addNodeRef("http://www.w3.org/ns/solid/terms#instance",a),b.addLiteral(o["a"].created,i),e.next=16,u.save();case 16:case"end":return e.stop()}}),e,this)})));function t(t,n,r){return e.apply(this,arguments)}return t}(),getIndexes:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var n,a,c,i,l,u,b;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n={puti:{instances:[],classes:[]},prti:{instances:[],classes:[]}},e.prev=1,e.next=4,Object(s["b"])(t);case 4:return a=e.sent,c=a.getSubject(t),e.next=8,c.getNodeRef("http://www.w3.org/ns/solid/terms#publicTypeIndex");case 8:return i=e.sent,e.next=11,c.getNodeRef("http://www.w3.org/ns/solid/terms#privateTypeIndex");case 11:return l=e.sent,n.puti.url=i,n.prti.url=l,e.next=16,Object(s["b"])(i);case 16:return u=e.sent,e.next=19,u.findSubjects("http://www.w3.org/ns/solid/terms#forClass");case 19:b=e.sent,b.forEach(function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(t){var r,s,a,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getRef("http://www.w3.org/ns/solid/terms#forClass");case 2:return r=e.sent,e.next=5,t.getRef("http://www.w3.org/ns/solid/terms#instance");case 5:return s=e.sent,e.next=8,t.getString(o["a"].created);case 8:return a=e.sent,e.next=11,t.getString(o["e"].label);case 11:c=e.sent,n.puti.instances.push({instance:s,classe:r,label:c,created:a}),void 0==n.puti.classes[r]&&(n.puti.classes[r]=[]),n.puti.classes[r].push(s);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=25;break;case 23:e.prev=23,e.t0=e["catch"](1);case 25:return console.log(t,n),e.abrupt("return",n);case 27:case"end":return e.stop()}}),e,null,[[1,23]])})));function t(t){return e.apply(this,arguments)}return t}(),makeToast:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.$bvToast.toast(t,{title:e,variant:n,solid:!0})}}}},"85fc":function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"inbox container"},[e._v(" webId : "+e._s(e.webId)+" "),null!=e.webId?n("div",[n("div",[n("b-button-toolbar",{attrs:{"aria-label":"Toolbar with button groups and dropdown menu"}},[n("b-button-group",{staticClass:"mx-1"},[n("b-button",{staticClass:"new",attrs:{title:"new",size:"sm",variant:"success"},on:{click:function(t){return t.stopPropagation(),e.init_new()}}},[n("b-icon-pencil-square",{attrs:{variant:"outline-success"},on:{click:function(t){return t.stopPropagation(),e.init_new()}}})],1)],1)],1)],1),n("b-list-group",e._l(e.inbox.files.slice().reverse(),(function(e){return n("b-list-group-item",{key:e.name,staticClass:"d-flex align-items-center"},[n("MessageLine",{attrs:{message:e}})],1)})),1),n("b-modal",{attrs:{id:"confirm-trash",title:"Are you sure you want to delete"},on:{ok:e.trash}},[e._v(" "+e._s(e.toTrash)+" ")]),n("b-modal",{attrs:{id:"send-modal",title:e.title},on:{ok:e.send,cancel:function(t){e.selected=[]}}},[n("div",{staticClass:"container flush"},[1==e.showFriends?n("FriendsSelection",{on:{selected:e.onSelected}}):e._e(),n("b-form-group",[n("label",{attrs:{for:"destinataire"}},[e._v("WebId :")]),n("b-form-input",{attrs:{id:"destinataire",placeholder:"ex: https://spoggy-test.solid.community/profile/card#me"},model:{value:e.recipient,callback:function(t){e.recipient=t},expression:"recipient"}})],1)],1),n("b-list-group",[n("b-input-group",{attrs:{prepend:"Label"}},[n("b-form-input",{model:{value:e.label,callback:function(t){e.label=t},expression:"label"}})],1),n("b-form-textarea",{attrs:{id:"textarea-rows",placeholder:"",rows:"8"},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1)],1),e._v(" webId : "+e._s(e.webId)+" inbox_urls : "+e._s(e.inbox_urls)+" "),e._m(0)],1):n("div",[n("SolidLoginButton")],1)])},s=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",[e._v("To test the inbox, you can add me to your friends :"),n("br"),e._v(" "),n("a",{attrs:{href:"https://spoggy.solid.community/profile/card#me",target:"_blank"}},[e._v("https://spoggy.solid.community/profile/card#me")]),n("br")])}],o=(n("99af"),n("4160"),n("fb6a"),n("d3b7"),n("ac1f"),n("1276"),n("159b"),n("96cf"),n("1da1")),a=n("4380"),c=n("eb27"),i=n("00e8"),l=n.n(i),u=n("4d8d"),b=n("6dc1"),d=window.SolidFileClient;console.log("SFC",d);var h=new d(l.a),p={name:"Inbox",mixins:[a["a"],c["a"]],components:{MessageLine:function(){return n.e("chunk-dacaf2b4").then(n.bind(null,"5d33"))},FriendsSelection:function(){return n.e("chunk-2d0b219b").then(n.bind(null,"2359"))},SolidLoginButton:function(){return n.e("chunk-6f9fdefe").then(n.bind(null,"e9a1"))}},props:["value"],data:function(){return{inbox_urls:[],inbox:{files:[]},selected:[],title:"",content:"",label:"",recipient:null,showFriends:!0}},created:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.webId=e.$store.state.solid.webId,console.log("################# created inbox webid",e.webId),null==e.webId){t.next=16;break}return t.next=5,e.getInboxUrls(e.webId);case 5:return e.inbox_urls=t.sent,e.storage=e.$store.state.solid.storage,t.next=9,e.inbox_init("created webId non null");case 9:return t.next=11,e.configureInbox(e.inbox_urls[0],e.webId,e.storage);case 11:e.inbox_log_file=e.storage+"popock/inbox_log.ttl",console.log("created inbox_log_file",e.inbox_log_file),e.subscribe(),t.next=18;break;case 16:return t.next=18,e.inbox_init("created webId null");case 18:case"end":return t.stop()}}),t)})))()},watch:{webId:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.inbox_init("webid watch");case 2:if(console.log("############# WEBID changed",e),null==e){n.next=7;break}return n.next=6,t.getInboxUrls(e);case 6:t.inbox_urls=n.sent;case 7:case"end":return n.stop()}}),n)})))()},inbox_urls:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.current_inbox_url=e[0],null!=t.current_inbox_url&&(console.log(t.current_inbox_url),t.getMessages());case 2:case"end":return n.stop()}}),n)})))()},reply:function(e){console.log("reply",e),this.showFriends=!1,this.$bvModal.show("send-modal"),this.selected=[],this.recipient=e.sender,this.label="ref: "+e.label},storage:function(e){null!=e&&(this.inbox_log_file=e+"popock/inbox_log.ttl",console.log("STORAGE WATCH inbox_log_file",this.inbox_log_file),this.subscribe())}},methods:{inbox_init:function(e){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:console.log("###################################### INBOX INIT from ",e),console.log("INIT WITH",t.webId,t.inbox_urls[0],t.storage);case 2:case"end":return n.stop()}}),n)})))()},notify:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"This is an example!";this.$notification.show("Hello World",{body:e},{})},send:function(){if(console.log(this.title,this.content,this.selected,this.label,this.recipient),null!=this.recipient&&this.selected.push(this.recipient),console.log("selected",this.selected),this.content.length>0){var e={};e.date=new Date(Date.now()),e.id=e.date.getTime(),e.sender=this.webId,e.content=this.content,e.label=this.label;var t='\n        @prefix : <#>.\n        @prefix schem: <http://schema.org/>.\n        @prefix sch: <https://schema.org/>.\n        @prefix rd: <http://www.w3.org/2000/01/rdf-schema#>.\n\n        <>\n        a sch:Message;\n        schem:dateSent "'.concat(e.date.toISOString(),'";\n        schem:sender <').concat(e.sender,'>;\n        schem:text "').concat(e.content,'";\n        rd:label "').concat(e.label,'";\n        schem:abstract "this message can be opened with inbox of Popock https://scenaristeur.github.io/solid-vue-panes/".\n        ');console.log(t);var n=this.getInboxUrls;console.log(this.selected),this.selected.forEach(function(){var r=Object(o["a"])(regeneratorRuntime.mark((function r(s){var o,a,c,i,l,d,p;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,n(s);case 2:if(o=r.sent,!(void 0!=o&&o.length>0)){r.next=38;break}return console.log("INBOX",o),e.url=o[0]+e.id+".ttl",console.log(e.url),r.next=9,h.postFile(e.url,t,"text/turtle");case 9:return console.log("find storage of ",s),r.next=12,Object(u["b"])(s);case 12:return a=r.sent,r.next=15,a.getSubject(s);case 15:return c=r.sent,r.next=18,c.getNodeRef(b["h"].storage);case 18:return i=r.sent,console.log("".concat(i)),l="".concat(i)+"popock/inbox_log.ttl",console.log(l),d={},r.prev=23,r.next=26,Object(u["b"])(l);case 26:d=r.sent,r.next=34;break;case 29:return r.prev=29,r.t0=r["catch"](23),r.next=33,Object(u["a"])(l);case 33:d=r.sent;case 34:return p=d.addSubject(),p.addNodeRef(b["f"].about,e.url),r.next=38,d.save();case 38:case"end":return r.stop()}}),r,null,[[23,29]])})));return function(e){return r.apply(this,arguments)}}())}else alert("content must not be empty")},onSelected:function(e){this.selected=e,console.log(this.selected)},init_new:function(){console.log("new"),this.showFriends=!0,this.$bvModal.show("send-modal"),this.selected=[],this.recipient=null,this.label="",this.content=""},subscribe:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var n,r,s,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n="wss://"+e.inbox_log_file.split("/")[2],r=new WebSocket(n,["solid.0.1.0"]),s=e.inbox_log_file,r.onopen=function(){this.send("sub "+s),console.log("subscribe to INBOX",n,s)},o=e.getMessages,r.onmessage=function(e){console.log(e),e.data&&"pub"===e.data.slice(0,3)&&(console.log(e.data),o())};case 6:case"end":return t.stop()}}),t)})))()},getMessages:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,h.readFolder(e.current_inbox_url);case 2:e.inbox=t.sent,e.notify(e.inbox.files.length+" messages !!!"),e.$store.commit("inbox/setInbox",e.inbox);case 5:case"end":return t.stop()}}),t)})))()},trash:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log(e.toTrash),t.next=3,h.deleteFile(e.toTrash);case 3:return console.log("File deleted !"),t.next=6,Object(u["b"])(e.inbox_log_file);case 6:return n=t.sent,r=n.findSubject(b["f"].about,e.toTrash),n.removeSubject(r),t.next=11,n.save();case 11:case"end":return t.stop()}}),t)})))()}},computed:{webId:{get:function(){return this.$store.state.solid.webId},set:function(){}},toTrash:function(){return this.$store.state.inbox.toTrash},reply:function(){return this.$store.state.inbox.reply},storage:{get:function(){return this.$store.state.solid.storage},set:function(){}}}},f=p,g=n("2877"),x=Object(g["a"])(f,r,s,!1,null,null,null);t["default"]=x.exports},"99af":function(e,t,n){"use strict";var r=n("23e7"),s=n("d039"),o=n("e8b5"),a=n("861d"),c=n("7b0b"),i=n("50c4"),l=n("8418"),u=n("65f0"),b=n("1dde"),d=n("b622"),h=n("2d00"),p=d("isConcatSpreadable"),f=9007199254740991,g="Maximum allowed index exceeded",x=h>=51||!s((function(){var e=[];return e[p]=!1,e.concat()[0]!==e})),w=b("concat"),m=function(e){if(!a(e))return!1;var t=e[p];return void 0!==t?!!t:o(e)},v=!x||!w;r({target:"Array",proto:!0,forced:v},{concat:function(e){var t,n,r,s,o,a=c(this),b=u(a,0),d=0;for(t=-1,r=arguments.length;t<r;t++)if(o=-1===t?a:arguments[t],m(o)){if(s=i(o.length),d+s>f)throw TypeError(g);for(n=0;n<s;n++,d++)n in o&&l(b,d,o[n])}else{if(d>=f)throw TypeError(g);l(b,d++,o)}return b.length=d,b}})},eb27:function(e,t,n){"use strict";n("96cf");var r=n("1da1"),s=n("93ef"),o=n("4d8d"),a=n("6dc1"),c=n("00e8"),i=n.n(c),l=window.SolidFileClient;console.log("SFC",l);var u=new l(i.a);t["a"]={created:function(){},methods:{configureInbox:function(e,t){var n=this;return Object(r["a"])(regeneratorRuntime.mark((function r(){var c,i,l,b,d,h,p,f,g,x,w,m,v,k,j,_;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log("configureInbox",e,t,n.storage),c=n.storage+"popock/inbox_log.ttl",r.next=4,u.itemExists(e);case 4:if(i=r.sent,i){r.next=8;break}return r.next=8,u.createFolder(e);case 8:return l={},r.prev=9,r.next=12,Object(o["b"])(c);case 12:l=r.sent,r.next=24;break;case 15:return r.prev=15,r.t0=r["catch"](9),r.next=19,Object(o["a"])(c);case 19:return l=r.sent,b=l.addSubject(),b.addNodeRef(a["f"].about,"init"),r.next=24,l.save();case 24:return r.prev=24,r.next=27,Object(s["f"])(e);case 27:return d=r.sent,h=Object(s["c"])(d,t),p=Object(s["d"])(d),null==h&&alert("Are you sure that you have allowed me to 'CONTROL' your POD, I can't read Acl of "+e+". I got a NULL value !! Please check your POD / Preferences / Trusted Application. "),console.log("inbox_url: ",e,"inbox_exists: ",i,"agentAcces: ",h,"publicAccess:",p),r.next=34,u.itemExists(c);case 34:if(f=r.sent,console.log("inbox_log_file_exists:",f),Object(s["i"])(d)){r.next=44;break}if(Object(s["g"])(d)){r.next=39;break}throw new Error("The current user does not have permission to change access rights to this Resource.");case 39:if(Object(s["h"])(d)){r.next=41;break}throw new Error("The current user does not have permission to see who currently has access to this Resource.");case 41:g=Object(s["a"])(d),r.next=45;break;case 44:g=Object(s["e"])(d);case 45:return x=Object(s["l"])(g,t,{read:!0,append:!0,write:!0,control:!0}),w=Object(s["k"])(g,t,{read:!0,append:!0,write:!0,control:!0}),m=Object(s["n"])(g,{read:!0,append:!0,write:!1,control:!1}),v=Object(s["m"])(g,{read:!1,append:!0,write:!1,control:!1}),r.prev=49,r.next=52,Object(s["j"])(d,x);case 52:console.log("owner Resource"),r.next=58;break;case 55:r.prev=55,r.t1=r["catch"](49),console.log("todo if 409 conflict : must test if ok before patch");case 58:return r.prev=58,r.next=61,Object(s["j"])(d,w);case 61:console.log("owner default"),r.next=67;break;case 64:r.prev=64,r.t2=r["catch"](58),console.log("todo if 409 conflict : must test if ok before patch");case 67:return r.prev=67,r.next=70,Object(s["j"])(d,m);case 70:console.log("posters Resource"),r.next=76;break;case 73:r.prev=73,r.t3=r["catch"](67),console.log("todo if 409 conflict : must test if ok before patch");case 76:return r.prev=76,r.next=79,Object(s["j"])(d,v);case 79:console.log("submitters Default"),r.next=85;break;case 82:r.prev=82,r.t4=r["catch"](76),console.log("todo if 409 conflict : must test if ok before patch");case 85:return r.next=87,Object(s["f"])(c);case 87:if(k=r.sent,Object(s["i"])(k)){r.next=96;break}if(Object(s["g"])(k)){r.next=91;break}throw new Error("The current user does not have permission to change access rights to this Resource.");case 91:if(Object(s["h"])(k)){r.next=93;break}throw new Error("The current user does not have permission to see who currently has access to this Resource.");case 93:j=Object(s["a"])(k),r.next=97;break;case 96:j=Object(s["e"])(k);case 97:return console.log("Log acl",j),_=Object(s["n"])(j,{read:!0,append:!0,write:!1,control:!1}),r.next=101,Object(s["j"])(k,_);case 101:console.log("logfile Default"),r.next=107;break;case 104:r.prev=104,r.t5=r["catch"](24),alert(r.t5);case 107:case"end":return r.stop()}}),r,null,[[9,15],[24,104],[49,55],[58,64],[67,73],[76,82]])})))()}}}}}]);
//# sourceMappingURL=chunk-e8c679c2.24d55436.js.map